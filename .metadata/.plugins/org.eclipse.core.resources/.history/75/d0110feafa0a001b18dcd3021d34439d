grammar com.agicquel.csvs.CSVs with org.eclipse.xtext.common.Terminals
generate csvs "http://www.agicquel.com/csvs/CSVs"

///////// PROGRAM //////////
Model: LC commands+=Command* LC;
LC : WS?;


///////// COMMANDS /////////
Command: (CsvCommand LC ';') | ControlCommand | {Command} CommentCommand;

Block: '{' LC Model LC '}';
ControlCommand: WhileCommand | IfCommand;
WhileCommand: 'while' LC '(' LC cond=Expression LC ')' LC body=Block;
IfCommand: 'if' LC '(' LC cond=Expression LC ')' LC thenBody=Block LC ('else' LC elseBody=Block LC)?;

CsvCommand:  | CreateCommand | SetCommand | PrintCommand | ExportCommand | DeleteCommand | AddCommand;
FileCommand: LoadCommand | StoreCommand | ExportCommand;
LoadCommand: 'load' LC var=ID LC path=STRING;
StoreCommand: 'store' LC var=ID LC path=STRING;
ExportCommand: 'export' LC var=ID LC path=STRING;
CreateCommand: 'create' LC var=ID;
SetCommand: 'set' LC var=Selector LC expression=Expression;
PrintCommand: 'print' LC expression=Selector;
DeleteCommand: 'delete' LC expression=Selector;
AddCommand: 'add' LC op=('row' | 'col') LC expression=Selector;

ApplyCommand: 'on' LC selection=Selector LC if=ApplyIfCommand? LC exec=ApplyExecCommand;
ApplyIfCommand: 'if' LC '(' LC cond=Expression LC ')';
ApplyExecCommand: 'apply' LC '(' LC ')';

CommentCommand: ML_COMMENT | SL_COMMENT;


/////// EXPRESSIONS ////////
Expression: OrExpr;

Selector: RowSelect | ColSelect | CellSelect | FieldSelect | VariableSelect;
RowSelect: 'row' LC var=ID LC '(' LC expression=PrimaryExpr LC ')';
ColSelect: 'col' LC var=ID LC '(' LC expression=PrimaryExpr LC ')';
CellSelect: 'cell' LC var=ID LC '(' LC expressionRow=PrimaryExpr LC ',' LC expressionCol=PrimaryExpr LC ')';
FieldSelect: 'field' LC var=ID LC '(' LC expression=PrimaryExpr LC ')';
VariableSelect: term=ID;
CountExpr: 'count' LC var=ID LC '(' LC expression=PrimaryExpr LC ')';

OrExpr: left=AddExpr (LC '||' LC right+=AddExpr)*;
AddExpr: left=EqualityExpr (LC '&&' LC right+=EqualityExpr)*;
EqualityExpr: left=ComparaisonExpr (LC op+=("==" | "!=") LC right+=ComparaisonExpr)*;
ComparaisonExpr: left=PlusOrMinusExpr (LC op+=(">=" | "<=" | ">" | "<") LC right+=PlusOrMinusExpr)*;
PlusOrMinusExpr: left=MulOrDivExpr (LC op+=("+" | "-") LC right+=MulOrDivExpr)*;
MulOrDivExpr: left=PrimaryExpr (LC op+=('*' | '/') LC right+=PrimaryExpr)*;
PrimaryExpr: ('(' LC Expression LC ')') | NotExpr | AtomicExpr | Selector | CountExpr;
NotExpr: '!' LC expr= PrimaryExpr;

AtomicExpr:
	{IntConstant} value=INT |
	{StringConstant} value=STRING |
	{BoolConstant} value=('true' | 'false')
;